<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Razorpay SPA (Netlify Backend)</title>

  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <!-- Axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <!-- Razorpay -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
<div id="app" class="container mt-5 col-md-4">
  <div class="card p-4 shadow">

    <h4 class="mb-3 text-center">Razorpay Test (Netlify)</h4>

    <input
      type="number"
      class="form-control mb-3"
      v-model="amount"
      placeholder="Enter Amount (₹)"
    >

    <button class="btn btn-primary w-100" @click="pay">
      Pay Now
    </button>

    <hr>

    <div>
      <p><b>Status:</b> {{ status }}</p>
      <p v-if="orderId"><b>Order ID:</b> {{ orderId }}</p>
      <p v-if="paymentId"><b>Payment ID:</b> {{ paymentId }}</p>
    </div>

  </div>
</div>

<script>
const { createApp } = Vue

createApp({
  data() {
    return {
      amount: '',
      status: 'Waiting',
      orderId: '',
      paymentId: ''
    }
  },
  methods: {
    async pay() {
      if (!this.amount) {
        alert("Enter amount")
        return
      }

      /* 1️⃣ CREATE ORDER (Netlify Function) */
      const orderRes = await axios.post(
        "/.netlify/functions/create-order",
        { amount: this.amount }
      )

      this.orderId = orderRes.data.id

      /* 2️⃣ RAZORPAY CHECKOUT */
      const options = {
        key: "rzp_test_RtbMCcc8qAfJPV",
        order_id: orderRes.data.id,
        amount: orderRes.data.amount,
        currency: "INR",
        name: "SPA Netlify App",
        description: "Razorpay Test Payment",

        handler: async (response) => {
          this.paymentId = response.razorpay_payment_id

          /* 3️⃣ VERIFY PAYMENT */
          const verifyRes = await axios.post(
            "/.netlify/functions/verify-payment",
            response
          )

          this.status = verifyRes.data.status
        },

        modal: {
          ondismiss: () => {
            this.status = "Payment Cancelled"
          }
        }
      }

      new Razorpay(options).open()
    }
  }
}).mount('#app')
</script>
</body>
</html>
